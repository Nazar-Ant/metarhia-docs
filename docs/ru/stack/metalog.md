# Metalog

Metalog - это логер стека Metarhia.

Metalog состоит из основного класса `Logger` и внутреннего собственного класса `Console`.
Последний реализует все методы класса `Console`, предоставляемого Node.js, кроме `dirxml` и [инспектирующих методов](https://nodejs.org/dist/latest-v20.x/docs/api/console.html#inspector-only-methods).
Если дальше упоминается класс `Console`, мы имеем в виду собственный класс `Console`.

## Использование

Пакет `metalog` експортирует функцию `openLog`, которая принимает [объект параметров](#параметры-логера) и возвращает екзепляр класса `Logger`.

```js
const metalog = require('metalog');

const logger = await metalog.openLog({
  toStdout: ['log'],
});

// `logger.console` содержит еземпляр класса `Console`.
logger.console.log('Тестовое сообщение');

// Для закрытия логера воспользуемся методом `close` класса `Logger`.
await logger.close();
```

### Переопределение `global.console`

Вы также можете заменить глобальный `console` на собственный:

```js
const logger = await metalog.openLog({ /** параметры */ });
global.console = logger.console;

// Теперь используется екземпляр собственного класса `Console`.
console.log('Тестовое сообщение');
```

:::warning
Будьте внимательны, потому что вы можете столкнуться с ошибками, если вдруг вы закрыли логер, а последующий код пытается вызвать какой-то из методов класса `Console`.
:::

## Параметры логера

| Параметр        | Тип (TypeScript)              | Значение по умолчанию  | Описание                                                                               |
|-----------------|-------------------------------|------------------------|----------------------------------------------------------------------------------------|
| `path`          | `string`                      | _остутствует_          | абсолютный или относительный путь к каталогу логов                                     |
| `home`          | `string`                      | _отсутствует_          | строка, которую следует вырезать из логируемых путей к файлам в трассировке стека      |
| `workerId`      | `number`                      | `0`                    | идентификатор воркера                                                                  |
| `createStream`  | `() => NodeJS.WritableStream` | `fs.createWriteStream` | функция, возвращающая екземпляр класса, реализующего интерфейс потока записи           |
| `writeInterval` | `number`                      | `3000`                 | число в миллисекундах, определяющее частоту записи в файл                              |
| `writeBuffer`   | `number`                      | `64 * 1024`            | размер буфера в байтах                                                                 |
| `keepDays`      | `number`                      | `1`                    | число, определяющее срок хранения файла логов; `0` отключает удаление файлов логов     |
| `json`          | `boolean`                     | `false`                | булевое значение, определяющее формат логов; `true` - json, `false` - обычный текст    |
| `toFile`        | `string[]`                    | `[]`                   | массив [флагов](#флаги), ограничивающий, какие типы логов стоит выводить в консоль     |
| `toStdout`      | `string[]`                    | `[]`                   | массив [флагов](#флаги), ограничивающий, какие типы логов стоит сохранять в файл логов |

Все перечисленные параметры необязательные.

> Если указан хоть один флаг для параметра `toFile`, обязательно должен быть указан параметр `path`.

## Флаги

Параметры `toFile` и `toStdout` принимают следующие флаги: `log`, `info`, `warn`, `debug`, `error`.

Некоторые методы класса `Console` требуют определенный флаг для своей работы.
Если нужный флаг не указан, вы не увидете вывод логов, но метод отработает правильно.

| Метод            | Требуемый флаг  |
|------------------|-----------------|
| `assert`         | `error`         |
| `clear`          | _отсутствует_   |
| `count`          | `debug`         |
| `countReset`     | _отсутствует_   |
| `debug`          | `debug`         |
| `dir`            | `debug`         |
| `trace`          | `debug`         |
| `info`           | `info`          |
| `log`            | `log`           |
| `warn`           | `warn`          |
| `error`          | `error`         |
| `group`          | `log`           |
| `groupCollapsed` | `log`           |
| `groupEnd`       | _отсутствует_   |
| `table`          | `log`           |
| `time`           | _отсутствует_   |
| `timeEnd`        | `debug`         |
| `timeLog`        | `debug`, `warn` |

## Общие сведения

- Источник: <https://github.com/metarhia/metalog>
- Пакет: <https://npmjs.com/package/metalog>
- Зависимости:
  - [concolor](./concolor.md)
  - [metautil](./metautil.md)
- Зависимые:
  - [impress](../impress/)
