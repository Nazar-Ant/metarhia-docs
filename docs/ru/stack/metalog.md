# Metalog

Metalog - это логер стека Metarhia.

Примечательные особенности Metalog:

- по умолчанию сохраненяет логи в файлы;
- автоматическое очищение устаревших файлов логов;
- поддержка логов в формате json;
- собственная логика для каждого метода обычного объекта `console`;
- форматирование трассировки стека;
- многое другое.

## Параметры логера

При создании екземпляра логера вы обязаны передать объект, который содержит следующие параметры:

| Параметр        | Тип                           | Значение по умолчанию  | Описание                                                                            |
|-----------------|-------------------------------|------------------------|-------------------------------------------------------------------------------------|
| `path`          | `string`                      | _остутствует_          | абсолютный или относительный путь к каталогу логов                                  |
| `home`          | `string`                      | _отсутствует_          | строка, которую следует вырезать из логируемых путей к файлам в трассировке стека   |
| `workerId`      | `number`                      | `0`                    | идентификатор воркера                                                               |
| `createStream`  | `() => NodeJS.WritableStream` | `fs.createWriteStream` | функция, возвращающая екземпляр класса, реализующего интерфейс потока записи        |
| `writeInterval` | `number`                      | `3000`                 | число в миллисекундах, определяющее частоту записи в файл                           |
| `writeBuffer`   | `number`                      | `64 * 1024`            | размер буфера в байтах                                                              |
| `keepDays`      | `number`                      | `1`                    | число, определяющее срок хранения файла логов; `0` отключает удаление файлов логов  |
| `json`          | `boolean`                     | `false`                | булевое значение, определяющее формат логов; `true` - json, `false` - обычный текст |
| `toFile`        | `string[]`                    | `[]`                   | массив **флагов**, ограничивающий, какие типы логов стоит выводить в консоль        |
| `toStdout`      | `string[]`                    | `[]`                   | массив **флагов**, ограничивающий, какие типы логов стоит сохранять в файл логов    |

Все перечисленные параметры необязательные.

> Если указан хоть один флаг для параметра `toFile`, обязательно должен быть указан параметр `path`.

:::tip Флаги
Параметры `toFile` и `toStdout` принимают следующие флаги: `log`, `info`, `warn`, `debug`, `error`.
:::

## Использование

Для создания екземпляра логера воспользуйтесь методом `openLog` объекта `metalog`:

```js
const logger = await metalog.openLog({
  path: './logs',
  home: process.cwd(),
  toStdout: ['log'],
  toFile: ['log'],
});

logger.console.log('Тестовое сообщение');
await logger.close();
```

## Замена глобального объекта `console`

Поскольку Metalog переопределяет все методы обычного объекта `console`, вы можете заменить глобальный объект `console` на соответствующий из екземпляра логера:

```js
const logger = await metalog.openLog({ ... });
global.console = logger.console;

/**
 * Теперь во всем окружении выполнения кода используется новый объект `console`.
 * И вам не нужно больше его импортировать, чтобы использовать.
 * Но будьте внимательны, ведь если вы закроете логер, а дальше по коду кто-то воспользуется `console`, вы столкнетесь с ошибкой.
 */

console.log('Тестовое сообщение');
```

## Общие сведения

- Источник: <https://github.com/metarhia/metalog>
- Пакет: <https://npmjs.com/package/metalog>
- Зависимости:
  - [concolor](./concolor.md)
  - [metautil](./metautil.md)
- Зависимые:
  - [impress](../impress/)
